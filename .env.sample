# ================================
# AR.IO BUNDLER CONFIGURATION
# ================================
# Single centralized configuration file for both Payment and Upload services
# Copy this file to .env and configure with your actual values

# ================================
# CORE CONFIGURATION
# ================================
NODE_ENV=production
MIGRATE_ON_STARTUP=false

# ================================
# SERVICE PORTS
# ================================
PAYMENT_SERVICE_PORT=4001
UPLOAD_SERVICE_PORT=3001

# ================================
# DATABASE CONFIGURATION
# ================================
DB_HOST=localhost
DB_PORT=5432
DB_USER=turbo_admin
DB_PASSWORD=postgres
DB_WRITER_ENDPOINT=localhost
DB_READER_ENDPOINT=localhost

# Database names (MUST be different for each service)
PAYMENT_DB_DATABASE=payment_service
UPLOAD_DB_DATABASE=upload_service

# Database connection pool configuration (for scale)
DB_POOL_MIN=5
DB_POOL_MAX=50
DB_ACQUIRE_TIMEOUT=10000
DB_IDLE_TIMEOUT=30000
DB_REAP_INTERVAL=1000

# ================================
# SERVER TIMEOUT CONFIGURATION
# ================================
# Upload Service (supports large files up to 10 GiB)
REQUEST_TIMEOUT_MS=600000
KEEPALIVE_TIMEOUT_MS=620000
HEADERS_TIMEOUT_MS=630000

# ================================
# SCALE & PERFORMANCE CONFIGURATION
# ================================
# Maximum data item size to cache in Redis (bytes)
# Items larger than this will be stored in object store only
# Default: 100 MB (104857600 bytes)
# WARNING: Setting too high can cause Redis OOM
MAX_CACHE_DATA_ITEM_SIZE=104857600

# Worker concurrency configuration (for BullMQ workers)
# Higher values increase throughput but use more memory
PLAN_WORKER_CONCURRENCY=5
PREPARE_WORKER_CONCURRENCY=3
POST_WORKER_CONCURRENCY=2
VERIFY_WORKER_CONCURRENCY=3

# ================================
# SECURITY & AUTHENTICATION
# ================================
# Inter-service authentication (MUST match between services)
# Generate with: openssl rand -hex 32
PRIVATE_ROUTE_SECRET=

# JWT secret for token generation
# Generate with: openssl rand -hex 32
JWT_SECRET=

# ================================
# ARWEAVE WALLET CONFIGURATION
# ================================
# Bundle signing wallet (MUST be absolute path)
TURBO_JWK_FILE=/home/vilenarios/ar-io-bundler/wallet.json

# Raw data item signing wallet (for server-signed uploads)
# Can be same as TURBO_JWK_FILE for testing, separate for production
RAW_DATA_ITEM_JWK_FILE=/home/vilenarios/ar-io-bundler/wallet.json

# Wallet addresses (MUST match your wallet.json)
ARWEAVE_ADDRESS=
ARIO_ADDRESS=

# Optional: Additional blockchain addresses for payment service
ETHEREUM_ADDRESS=
SOLANA_ADDRESS=
MATIC_ADDRESS=
BASE_ETH_ADDRESS=
KYVE_ADDRESS=

# ================================
# X402 PAYMENT PROTOCOL (Primary Payment Method)
# ================================
# Enable/disable x402 payments (default: true)
X402_ENABLED=true

# Your receiving wallet address (REQUIRED if x402 enabled)
X402_PAYMENT_ADDRESS=

# ---- Coinbase CDP Credentials (REQUIRED for MAINNET) ----
# Get credentials from: https://portal.cdp.coinbase.com/
# NOT required for testnet (use public facilitator)
CDP_API_KEY_ID=
CDP_API_KEY_SECRET=

# ---- Browser Paywall Integration (OPTIONAL) ----
# CDP Client Key enables browser-based payment UI with Coinbase Onramp
# This is the PUBLIC client key (safe for browser/client-side use)
# Leave empty for API-only usage
X_402_CDP_CLIENT_KEY=

# ---- Network Configuration ----
# Base Mainnet (Primary - USDC on Base)
X402_BASE_ENABLED=true
BASE_MAINNET_RPC_URL=https://mainnet.base.org
X402_BASE_MIN_CONFIRMATIONS=1
# Multiple facilitators (comma-separated) for automatic fallback
# If not set, defaults to: Coinbase, Mogami
# Example: X402_FACILITATOR_URLS_BASE=https://api.cdp.coinbase.com/platform/v2/x402,https://facilitator.mogami.tech
X402_FACILITATOR_URLS_BASE=

# Ethereum Mainnet (Optional)
X402_ETH_ENABLED=false
ETHEREUM_MAINNET_RPC_URL=https://cloudflare-eth.com/
X402_ETH_MIN_CONFIRMATIONS=3
X402_FACILITATOR_URLS_ETH=

# Polygon Mainnet (Optional)
X402_POLYGON_ENABLED=false
POLYGON_MAINNET_RPC_URL=https://polygon-rpc.com/
X402_POLYGON_MIN_CONFIRMATIONS=10
X402_FACILITATOR_URLS_POLYGON=

# Base Sepolia Testnet (For Development)
X402_BASE_TESTNET_ENABLED=false
BASE_SEPOLIA_RPC_URL=https://sepolia.base.org
X402_FACILITATOR_URLS_BASE_TESTNET=

# ---- Payment Configuration ----
# Payment mode: payg, topup, or hybrid (default)
X402_DEFAULT_MODE=hybrid

# Payment timeout (5 minutes default)
X402_PAYMENT_TIMEOUT_MS=300000

# Price buffer for volatility (15% default)
X402_PRICING_BUFFER_PERCENT=15

# Fraud detection tolerance (5% default)
X402_FRAUD_TOLERANCE_PERCENT=5

# Minimum payment amount in whole USDC dollars (e.g., 0.001 = $0.001)
X402_MINIMUM_PAYMENT_USDC=0.001

# ---- Upload Service x402 Configuration ----
# Fee percentage added to x402 pricing (default: 15%)
# This is your profit margin on top of base Arweave storage cost
X402_FEE_PERCENT=15

# Public URL of upload service (used in x402 payment requirements)
UPLOAD_SERVICE_PUBLIC_URL=http://localhost:3001

# ---- CoinGecko API (for AR/USD pricing) ----
# Optional - uses free tier if not set
COINGECKO_API_KEY=
COINGECKO_API_URL=https://api.coingecko.com/api/v3/

# ================================
# REDIS CONFIGURATION
# ================================
# Redis Cache (ElastiCache - for data caching)
REDIS_CACHE_HOST=localhost
REDIS_CACHE_PORT=6379
ELASTICACHE_HOST=localhost
ELASTICACHE_PORT=6379
ELASTICACHE_NO_CLUSTERING=true
ELASTICACHE_PASSWORD=
ELASTICACHE_USE_TLS=false

# Redis Queues (BullMQ - for job processing)
REDIS_QUEUE_HOST=localhost
REDIS_QUEUE_PORT=6381
REDIS_HOST=localhost
REDIS_PORT_QUEUES=6381

# ================================
# MINIO/S3 CONFIGURATION
# ================================
# S3-compatible object storage
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY_ID=minioadmin
S3_SECRET_ACCESS_KEY=minioadmin123
S3_REGION=us-east-1
S3_FORCE_PATH_STYLE=true
S3_SESSION_TOKEN=

# Bucket names
DATA_ITEM_BUCKET=raw-data-items
BACKUP_DATA_ITEM_BUCKET=backup-data-items

# Optional: Regional configuration
DATA_ITEM_BUCKET_REGION=us-east-1
BACKUP_BUCKET_REGION=us-east-1

# Optional: Retry configuration
S3_RETRY_MAX_ATTEMPTS=5
S3_RETRY_BASE_DELAY_MS=100

# Optional: S3 key prefixes
DATA_ITEM_S3_PREFIX=raw-data-item
MULTIPART_S3_PREFIX=multipart-uploads
BUNDLE_PAYLOAD_S3_PREFIX=bundle-payload
BUNDLE_TX_S3_PREFIX=bundle

# ================================
# ARWEAVE GATEWAY CONFIGURATION
# ================================
# Gateway for reads, verification, and GraphQL queries
# Use http://localhost:3000 for local AR.IO Gateway
ARWEAVE_GATEWAY=http://localhost:3000

# Public access gateway (can be same as ARWEAVE_GATEWAY)
PUBLIC_ACCESS_GATEWAY=http://localhost:3000

# Upload node for TX headers and chunk uploads
# Should be arweave.net for reliability (AR.IO Gateways don't support /chunk)
ARWEAVE_UPLOAD_NODE=https://arweave.net:443

# Optional: Network request timeout (milliseconds)
ARWEAVE_NETWORK_REQUEST_TIMEOUT_MS=60000

# ================================
# AR.IO GATEWAY INTEGRATION (Optimistic Caching)
# ================================
# Enable optimistic caching (optical bridging)
OPTICAL_BRIDGING_ENABLED=true

# AR.IO Gateway admin endpoint
OPTICAL_BRIDGE_URL=http://localhost:4000/ar-io/admin/queue-data-item

# AR.IO Gateway admin key
AR_IO_ADMIN_KEY=

# Optional: Additional optical bridge URLs (comma-separated)
OPTIONAL_OPTICAL_BRIDGE_URLS=

# ================================
# INTER-SERVICE COMMUNICATION
# ================================
# Payment service URL for upload service (NO protocol prefix)
PAYMENT_SERVICE_BASE_URL=localhost:4001

# Optional: Protocol override (defaults to "http")
PAYMENT_SERVICE_PROTOCOL=http

# ================================
# PAYMENT SERVICE CONFIGURATION
# ================================
# ---- Cryptocurrency Payments (Secondary) ----
# Enable crypto payment monitoring
CRYPTO_MONITORING_ENABLED=false

# Gateway URLs for different blockchains
ETHEREUM_GATEWAY=https://cloudflare-eth.com/
MATIC_GATEWAY=https://polygon-rpc.com/
SOLANA_GATEWAY=https://api.mainnet-beta.solana.com/
KYVE_GATEWAY=https://api.kyve.network/
BASE_ETH_GATEWAY=https://mainnet.base.org

# Exclude addresses from crypto fund monitoring (comma-separated)
CRYPTO_FUND_EXCLUDED_ADDRESSES=

# Minimum confirmations for crypto payments
ARWEAVE_MIN_CONFIRMATIONS=18
ETHEREUM_MIN_CONFIRMATIONS=5
MATIC_MIN_CONFIRMATIONS=12
BASE_ETH_MIN_CONFIRMATIONS=5
DEFAULT_MIN_CONFIRMATIONS=5

# Crypto payment polling configuration
PAYMENT_TX_POLLING_WAIT_TIME_MS=500
MAX_PAYMENT_TX_POLLING_ATTEMPTS=5

# ---- Stripe Payments (Optional) ----
# Enable Stripe credit card payments
STRIPE_ENABLED=false

# Stripe API credentials
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=

# Payment quote expiration (30 minutes default)
TOP_UP_QUOTE_EXPIRATION_MS=1800000

# Auto Stripe tax
ENABLE_AUTO_STRIPE_TAX=false

# ---- ArNS (Arweave Name System) (Optional) ----
# Enable ArNS purchases
ARNS_ENABLED=false

# ArNS signing wallet (JSON string)
ARIO_SIGNING_JWK=

# ArNS configuration
ARIO_PROCESS_ID=
CU_URL=
ARIO_LEASE_NAME_DUST_AMOUNT=1
ARIO_PERMA_BUY_NAME_DUST_AMOUNT=5

# ---- Gifting (Optional) ----
# Enable gifting via email
GIFTING_ENABLED=false
GIFTING_EMAIL_ADDRESS=gift@ardrive.io
MAX_GIFT_MESSAGE_LENGTH=250

# ---- Email Notifications (Optional) ----
# Mandrill/SendGrid for email notifications
MANDRILL_API_KEY=
SENDGRID_API_KEY=

# ---- Payment Service Features ----
# Maximum allowed chargebacks before marking wallet as fraudulent
MAX_ALLOWED_CHARGE_BACKS=1

# Tokens exempt from fees (comma-separated)
TOKENS_WITHOUT_FEES=

# Public gateway FQDNs (comma-separated)
PUBLIC_GATEWAY_FQDNS=

# ================================
# UPLOAD SERVICE CONFIGURATION
# ================================
# ---- Upload Features ----
# Allow listed addresses for free uploads (comma-separated)
ALLOW_LISTED_ADDRESSES=

# Skip balance checks (for testing)
SKIP_BALANCE_CHECKS=false

# Data item and bundle size limits
MAX_DATA_ITEM_SIZE=10737418240
MAX_DATA_ITEM_LIMIT=10000
MAX_BUNDLE_SIZE=2147483648
FREE_UPLOAD_LIMIT=517120

# Allow ArFS data
ALLOW_ARFS_DATA=false

# ---- Upload Service Features ----
# Bundle metadata tags
APP_NAME=AR.IO Bundler

# Blocklisted addresses (comma-separated)
BLOCKLISTED_ADDRESSES=

# Allow listed signature types (comma-separated signature type IDs)
ALLOW_LISTED_SIGNATURE_TYPES=

# ---- Data Caches & Indexes ----
# Data caches (comma-separated)
DATA_CACHES=

# Fast finality indexes (comma-separated)
FAST_FINALITY_INDEXES=

# ---- Special Address Lists (comma-separated) ----
WARP_ADDRESSES=
REDSTONE_ORACLE_ADDRESSES=
FIRST_BATCH_ADDRESSES=
AO_ADDRESSES=
KYVE_ADDRESSES=
ARIO_MAINNET_PROCESSES=
ARIO_TESTNET_PROCESSES=
ANT_REGISTRY_MAINNET_PROCESSES=
ANT_REGISTRY_TESTNET_PROCESSES=
SKIP_OPTICAL_POST_ADDRESSES=

# ---- Timing Configuration ----
# Overdue data item threshold (milliseconds)
OVERDUE_DATA_ITEM_THRESHOLD_MS=300000

# In-flight data item TTL (seconds)
# Should be longer than max expected upload time
# 10 GiB @ 100 MB/s = ~100 seconds, set to 600s (10 min) for safety
IN_FLIGHT_DATA_ITEM_TTL_SECS=600

# Quarantined small data item TTL (seconds)
QUARANTINED_SMALL_DATAITEM_TTL_SECS=432000

# ---- Filesystem Storage (Optional) ----
# Path for persistent data item backup storage
FS_DATA_PATH=./upload-service-data

# Temporary file storage
TEMP_DIR=./temp

# EFS mount point (if using network filesystem)
EFS_MOUNT_POINT=

# ---- Database Migration Backfill (Advanced) ----
PERMANENT_DATA_ITEM_BACKFILL_START_BLOCK=1045991
PERMANENT_DATA_ITEM_BACKFILL_END_BLOCK=1470456

# ================================
# WORKER CONFIGURATION
# ================================
# Worker concurrency settings
WORKER_CONCURRENCY_ADMIN_CREDIT=2
WORKER_CONCURRENCY_PENDING_TX=1

# PM2 instance configuration
API_INSTANCES=2
WORKER_INSTANCES=1

# ================================
# LOGGING & MONITORING
# ================================
# Logging configuration
LOG_LEVEL=info
LOG_ALL_STACKTRACES=false
LOG_FORMAT=simple
DISABLE_LOGS=false

# ---- OpenTelemetry (Optional) ----
# Enable OpenTelemetry tracing
OTEL_ENABLED=false
OTEL_COLLECTOR_URL=
OTEL_SAMPLE_RATE=200

# ---- Prometheus (Optional) ----
# Prometheus metrics port
PROMETHEUS_PORT=9090

# ---- Debug Flags ----
# Stream debugging
STREAM_DEBUG=false

# ================================
# RATE LIMITING (Optional)
# ================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_WINDOW_MS=60000

# ================================
# ADVANCED CONFIGURATION (Rarely Changed)
# ================================
# PostgreSQL version
POSTGRES_VERSION=16.1
